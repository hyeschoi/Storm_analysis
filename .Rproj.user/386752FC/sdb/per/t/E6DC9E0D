{
    "contents" : "##----------------------------------------------------------------------------------------------\n#    Header\n##----------------------------------------------------------------------------------------------\n#\n# In this rscript file,\n# we will process and clean raw data initially saved in 'raw_data' folder, \n# As a result, we will create two cleaned data frames 'storms' and 'tracks', and\n# then save the cleaned data frames as csv files to 'data' folder\n#\n# For further details,\n#\n# storms.csv will contain the following columns\n#     id: Storm number since year 1851\n#     date: MM/DD/Year  (as Date)\n#     days: Number of days in which positions are available\n#     name: Name of the storm\n#\n#\n# tracks.csv will contain the following columns\n#     id: Storm number since year 1851\n#     date: MM/DD/Year  (as Date)\n#     period: 00h, 06h, 12h, 18h\n#     stage: type of stage\n#     lat: latitude\n#     long: longitude (negative degrees for west)\n#     wind: wind speed\n#     press: surface pressure\n#\n\n\n\n##----------------------------------------------------------------------------------------------\n#     Required packages\n##----------------------------------------------------------------------------------------------\n\nlibrary(readr)\nlibrary(stringr)\n\n\n\n##----------------------------------------------------------------------------------------------\n#    Import data\n##----------------------------------------------------------------------------------------------\n# import the raw data from 'rawdata' folder\n# and save the imported data as a character vector 'storm_data'\n\nstorm.data <- read_lines('./rawdata/Basin.NA.ibtracs_hurdat.v03r06.hdat')\n \n \n\n##----------------------------------------------------------------------------------------------\n#    Data processing and cleaning\n##----------------------------------------------------------------------------------------------\n# From uncleaned storm_data\n# we will first devide the storm_data into two parts: one containg HEADER and the other containing DAILY DATA.\n# \n# \n# Then, we will extract \n#     id: Storm number since year 1851\n#     date: MM/DD/Year  (as Date)\n#     days: Number of days in which positions are available\n#     name: Name of the storm\n# from HEADER and then\n# form a data frame named 'storms' with these extracted values.\n# \n# \n# Then, we will extract \n#     id: Storm number since year 1851\n#     date: MM/DD/Year  (as Date)\n#     period: 00h, 06h, 12h, 18h\n#     stage: type of stage\n#     lat: latitude\n#     long: longitude (negative degrees for west)\n#     wind: wind speed\n#     press: surface pressure \n# from DAILY DATA and then form a data frame named 'tracks'\n# with these extracted values\n#\n# \n# ================= Devide into HEADER and DAILY DATA ============================== \n\n# extract only HEADER and only DAILY DATA\n# Note: HEADER lines always contains string 'SNBR', but DAILY DATA and TRAILER do not.\n# Note: TRAILER lines always contains string 'SRC', but DAILY DATA and HEADER do not.\n\nheader <- grep(storm.data, pattern = 'SNBR', value = TRUE)\ndaily.data <- storm.data[-grep(storm.data, pattern= \"SNBR|SRC\")]\n\n\n\n\n# ================= Process and clean HEADER ====================================== \n#\n#\n#\n# Because within HEADER numbers and strings are distinguised by either ' ' or '=',\n# we will split extracted header lines by either '=' or 'blank' into substrings to separate all numbers and strings\n \nstr.headers <- strsplit(header, split =  '= *| +', fixed = FALSE)\n \n\n\nExtract<-function(i, list.str){\n# Extracts the i-th string from each character vector in list 'list.str' \n#\n# Args: \n#   i  : a positive integer index where the string is to be extracted\n#   list.str: a list of character vectors whose i-th elements is to be extracted\n#\n# Returns:\n#   The vector of i-th string in the vector in the list 'list.str'  \n  sapply(list.str,function(x){x[i]})\n}\n\n\n \n \n# By using function 'Extract', extracts data,name, days of each storms from header \n# Note: 2nd string in each string vector is date,\n#     : 4th string in each string vector is days(duration),\n#     : 8th string in each string vector is name.\n \ndate <- as.Date(Extract(2, str.headers), format ='%m/%d/%Y') # save as Date\ndays <- as.numeric(Extract(4, str.headers)) \nname <- Extract(8, str.headers)\n\n\n\n# create a data frame named 'storms'\n# containing id,date,duration(days), and name of storms\n# one storm per row\n \nn <- length(date) # number of storms\nstorms <- data.frame(id= 1:n, date= format(date, format = '%m/%d/%Y'), days = days , name= name)\n\n\n\n# ================== Process and clean DAILY DATA ===============================\n \n# To acquired information about in which stage each storm was,\n# we need to extract a letter that represent its stage.\n# The result will be one of followings:\n# '*' (tropical cyclone stage),\n# 'S' (Subtropical stage)\n# 'E' (extratropical stage)\n# 'W' (wave stage - rarely used)\n# 'L' (remanent Low stage - rarely used)\n#\n#\n\n\n# Extract Stage letter \n#\nStageLetter <- function(str){\n# Extracts a letter that represent its stage. \n#\n# Args: \n#   str: a string that contains only one of {'*','S','E','W','L'}\n#\n#\n# Returns:\n#   a character in {'*','S','E','W','L'} that is in str   \n  str_extract_all(str, '\\\\*|S|E|W|L')\n}\n\nstage.letter <- StageLetter(daily.data)\n\nRemoveLastStar <- function(x){\n  x[-length(x)]\n}\n\nstage.letter <- lapply(stage.letter, RemoveLastStar)\nstage.letter <- unlist(stage.letter)\n\n# Transform the extracted stage letter, which is abbreviated, to its full stage name.\n# '*' : cyclone,\n# 'S' : subtropical\n# 'E' : extratropical\n# 'W' : wave\n# 'L' : remanent low \n\nStage <- function (str) { switch (\n  str,\n  '*' = 'cyclone',\n  S = 'subtropical',\n  E = 'extratropical',\n  W = 'wave',\n  'remant low'\n  )\n}\n\n\n# stage name of each observations\nstage <- sapply(stage.letter, Stage) \n\n\n# ============= Extract lat, long, wind, press ========================================\n\n# In DAILY DATA, values can be distingusighed by either stage character ('*', 'S', 'E', 'W', 'L') or ' '.\n# we will split DAILY DATA lines by either stage character ('*', 'S', 'E', 'W', 'L') or ' ' into substrings \n# to facilitate extracting procedure\n\nstr.daily <- strsplit(daily.data, '\\\\*|S|E|W|L')\n\n# Extract the part that contains information about latitude, longitude, and pressure\n\nstr.daily.info <- lapply(str.daily, function(x) {\n  x[2:5]\n  })\nstr.daily.info <- unlist(str.daily.info) \n\n# extract latitude and convert it as numeric vector\n# need to multiply by 0.1 according to notation rule of HURDAT format\n\nlat <- as.numeric(substr(str.daily.info, 1, 3)) * 0.1 \n\n\n# extract longitude and convert it as numeric vector\n# need to multiply by 0.1 according to notation rule of HURDAT format\n# Note: this longitude is within the range [0, 360]\n#     : therefore, it needs to be converted into a new range [-180,180]\n\nlong <- as.numeric(substr(str.daily.info, 4, 7)) * 0.1\ntemp <- long[long > 180]\nlong[long > 180] <- temp - 360 # change longitude range from [0, 360] to [-180, 180]\n\n# extract wind speed in knots\n\nwind <- as.numeric(substr(str.daily.info, 8, 11))\n\n# extract pressure in mb\n\npress <- as.numeric(substr(str.daily.info, 12, 16))\n\n\n\n# ============ Extract id, date, period =============================================\n\n\n# date and id for daily data\n# Note : each storms lasted for corresponding 'days' value in storms data frame.\n#      : on each day, there are 4 observations.\n\nyears <- format(rep(date, times = (days * 4)), format = '%Y') # extract year from HEADER\ntemp <- Extract(i = 1, str.daily) # part containing month/day\ndate.temp <- str_extract(temp, '[0-9]{2}/[0-9]{2}') # extract month/day from DAILY DATA\n\ndate.tracks <- paste(rep(date.temp, each = 4), '/', years, sep='') # concatenate 'month/day' to 'year'\nid.tracks <- rep(1:n, times = (days * 4))\nperiod <- rep(c('00h','06h','12h','18h'), length(daily.data))\n\n\n# =============== Combine all variables by creating a data frame ================================\n# Create data frame named 'tracks' by combining the follwing set of varaibles for storms:\n# id\n# date\n# lat: latitude\n# long: longitude (negative degrees for west)\n# wind: wind speed\n# press: surface pressure\n\ntracks <- data.frame(id = id.tracks, date = date.tracks, stage = stage, lat = lat, long = long, wind = wind, press = press)\n\n# Remove those observations where lat, long, wind and press are all zeros\n\ntracks <- subset(tracks, subset = !(lat == 0 & long == 0 & wind == 0 & press == 0))\n?subset\n\ntracks %>% filter(lat != 0 | long != 0 | wind != 0| press !=0) \n##----------------------------------------------------------------------------------------------\n#   Save \n##----------------------------------------------------------------------------------------------\n# save the cleaned data frames as csv files\n# the files will be saved in 'data' folder with name 'storms.scv'\n#\n \nwrite_csv(storms, './data/storms.csv')\nwrite_csv(tracks, './data/tracks.csv')\n \n \n \n \n ",
    "created" : 1438900047627.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3425880711",
    "id" : "E6DC9E0D",
    "lastKnownWriteTime" : 1439585042,
    "path" : "~/Downloads/Final_project 2/code/Data_cleaning.R",
    "project_path" : "code/Data_cleaning.R",
    "properties" : {
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "type" : "r_source"
}